# Production Environment Configuration for HealthCoachAI
# This file contains production-ready settings and should be used with proper secret management

# ===================================
# CORE APPLICATION SETTINGS
# ===================================
NODE_ENV=production
PORT=8080
API_BASE_URL=https://api.healthcoachai.com
APP_ORIGIN=https://app.healthcoachai.com
API_VERSION=v1

# ===================================
# DATABASE CONFIGURATION
# ===================================
# PostgreSQL Primary Database
DB_HOST=${POSTGRES_HOST}
DB_PORT=5432
DB_USERNAME=${POSTGRES_USERNAME}
DB_PASSWORD=${POSTGRES_PASSWORD}
DB_NAME=healthcoachai_prod
DB_SSL=true
DB_MAX_CONNECTIONS=100
DB_CONNECTION_TIMEOUT=30000
DB_IDLE_TIMEOUT=10000

# PostgreSQL Connection URL (for TypeORM)
POSTGRES_URL=postgresql://${POSTGRES_USERNAME}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:5432/healthcoachai_prod?sslmode=require

# Read Replica Configuration
DB_READ_REPLICA_HOST=${POSTGRES_READ_REPLICA_HOST}
DB_READ_REPLICA_ENABLED=true

# ===================================
# REDIS CACHE CONFIGURATION
# ===================================
REDIS_HOST=${REDIS_HOST}
REDIS_PORT=6379
REDIS_PASSWORD=${REDIS_PASSWORD}
REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:6379
REDIS_TTL_DEFAULT=3600
REDIS_MAX_CONNECTIONS=50

# Cache Settings
CACHE_TTL=300
CACHE_MAX_ITEMS=50000
CACHE_COMPRESSION=true

# ===================================
# AI PROVIDERS & POLICY CONFIGURATION
# ===================================
# Daily Tiering Limits (Level 1: High-cost, Level 2: Standard)
AI_POLICY_LEVEL1_DAILY_TIERS=100,500,1000,5000
AI_POLICY_LEVEL2_DAILY_TIERS=1000,5000,10000,50000
AI_POLICY_LEVEL2_ACCURACY_WINDOW=0.05
AI_VENDOR_LIST=openai,anthropic,vertex,openrouter,together
AI_ZERO_RETENTION=true
AI_CACHE_ENABLED=true
AI_CACHE_TTL=3600

# Policy Table Configuration
AI_POLICY_TABLE_PATH=/app/config/ai-policy-table.json
AI_POLICY_HOT_RELOAD=true
AI_POLICY_RELOAD_INTERVAL=60

# OpenAI Configuration
OPENAI_API_KEY=${OPENAI_API_KEY}
OPENAI_ORGANIZATION=${OPENAI_ORGANIZATION}
OPENAI_MODELS_LEVEL1=gpt-4-turbo,gpt-4
OPENAI_MODELS_LEVEL2=gpt-3.5-turbo
OPENAI_MAX_TOKENS=4096
OPENAI_RATE_LIMIT_RPM=10000
OPENAI_RATE_LIMIT_TPM=1000000

# Anthropic Configuration
ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
ANTHROPIC_MODELS_LEVEL1=claude-3-opus,claude-3-sonnet
ANTHROPIC_MODELS_LEVEL2=claude-3-haiku
ANTHROPIC_MAX_TOKENS=4096
ANTHROPIC_RATE_LIMIT_RPM=5000

# Google Vertex AI Configuration
GOOGLE_VERTEX_PROJECT=${GOOGLE_CLOUD_PROJECT}
GOOGLE_VERTEX_LOCATION=us-central1
GOOGLE_APPLICATION_CREDENTIALS_B64=${GOOGLE_SERVICE_ACCOUNT_KEY}
VERTEX_MODELS_LEVEL1=gemini-pro,gemini-pro-vision
VERTEX_MODELS_LEVEL2=gemini-pro
VERTEX_RATE_LIMIT_RPM=1000

# OpenRouter Configuration
OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
OPENROUTER_MODELS_LEVEL2=meta-llama/llama-3-70b,mistralai/mixtral-8x22b
OPENROUTER_RATE_LIMIT_RPM=1000

# Together AI Configuration
TOGETHER_API_KEY=${TOGETHER_API_KEY}
TOGETHER_MODELS_LEVEL2=meta-llama/Llama-3-70b,mistralai/Mixtral-8x22B
TOGETHER_RATE_LIMIT_RPM=1000

# ===================================
# OBJECT STORAGE (S3-compatible)
# ===================================
S3_ENDPOINT=${S3_ENDPOINT}
S3_BUCKET=healthcoachai-prod
S3_ACCESS_KEY=${S3_ACCESS_KEY}
S3_SECRET_KEY=${S3_SECRET_KEY}
S3_REGION=us-east-1
S3_FORCE_PATH_STYLE=false
S3_MAX_FILE_SIZE=100MB

# ===================================
# AUTHENTICATION & SECURITY
# ===================================
# JWT Configuration
JWT_SECRET=${JWT_SECRET}
JWT_ACCESS_TTL=900
JWT_REFRESH_TTL=1209600
JWT_ISSUER=healthcoachai-prod
JWT_ALGORITHM=HS256

# OAuth Providers
GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
APPLE_CLIENT_ID=${APPLE_CLIENT_ID}
APPLE_TEAM_ID=${APPLE_TEAM_ID}
APPLE_KEY_ID=${APPLE_KEY_ID}
APPLE_PRIVATE_KEY_B64=${APPLE_PRIVATE_KEY_B64}
FACEBOOK_APP_ID=${FACEBOOK_APP_ID}
FACEBOOK_APP_SECRET=${FACEBOOK_APP_SECRET}

# Security Settings
BCRYPT_ROUNDS=12
CORS_ORIGINS=https://app.healthcoachai.com,https://admin.healthcoachai.com
HELMET_ENABLED=true
RATE_LIMITING_ENABLED=true

# ===================================
# RATE LIMITING & THROTTLING
# ===================================
# Global Rate Limits
THROTTLE_TTL=60
THROTTLE_LIMIT=10000
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=10000
RATE_LIMIT_AUTH_MAX_REQUESTS=50000

# AI-specific Rate Limits
AI_RATE_LIMIT_FREE_TIER=50
AI_RATE_LIMIT_BASIC_TIER=200
AI_RATE_LIMIT_PREMIUM_TIER=1000
AI_RATE_LIMIT_ENTERPRISE_TIER=10000

# ===================================
# EXTERNAL INTEGRATIONS
# ===================================
# OCR Providers
OCR_PRIMARY=documentai
OCR_FALLBACK=textract

# Google Document AI
GOOGLE_DOCUMENTAI_PROJECT=${GOOGLE_CLOUD_PROJECT}
GOOGLE_DOCUMENTAI_LOCATION=us
GOOGLE_DOCUMENTAI_PROCESSOR_ID=${DOCUMENTAI_PROCESSOR_ID}

# AWS Textract
AWS_TEXTRACT_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
AWS_TEXTRACT_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
AWS_TEXTRACT_REGION=us-east-1

# External APIs
FITBIT_CLIENT_ID=${FITBIT_CLIENT_ID}
FITBIT_CLIENT_SECRET=${FITBIT_CLIENT_SECRET}
OPENWEATHER_API_KEY=${OPENWEATHER_API_KEY}
IQAIR_API_KEY=${IQAIR_API_KEY}
USDA_API_KEY=${USDA_API_KEY}

# ===================================
# PUSH NOTIFICATIONS
# ===================================
# Apple Push Notifications
APNS_KEY_ID=${APNS_KEY_ID}
APNS_TEAM_ID=${APNS_TEAM_ID}
APNS_PRIVATE_KEY_B64=${APNS_PRIVATE_KEY_B64}
APNS_BUNDLE_ID=com.healthcoachai.app
APNS_ENVIRONMENT=production

# Firebase Cloud Messaging
FCM_PROJECT_ID=${FCM_PROJECT_ID}
FCM_CLIENT_EMAIL=${FCM_SERVICE_ACCOUNT_EMAIL}
FCM_PRIVATE_KEY_B64=${FCM_PRIVATE_KEY_B64}

# ===================================
# MONITORING & OBSERVABILITY
# ===================================
# OpenTelemetry
OTEL_EXPORTER_OTLP_ENDPOINT=${OTEL_ENDPOINT}
OTEL_SERVICE_NAME=healthcoachai-backend
OTEL_SERVICE_VERSION=1.0.0
OTEL_RESOURCE_ATTRIBUTES=environment=production

# Sentry Error Tracking
SENTRY_DSN=${SENTRY_DSN}
SENTRY_ENVIRONMENT=production
SENTRY_SAMPLE_RATE=0.1
SENTRY_TRACES_SAMPLE_RATE=0.01

# Logging
LOG_LEVEL=info
DEBUG_SQL=false
LOG_FORMAT=json
LOG_ROTATION=daily
LOG_MAX_FILES=30

# ===================================
# FEATURE FLAGS
# ===================================
FEATURE_CHAT_ENABLED=true
FEATURE_PHOTO_LOG_ENABLED=true
FEATURE_VOICE_INPUT_ENABLED=true
FEATURE_PREMIUM_FEATURES_ENABLED=true
FEATURE_HEALTH_REPORTS_ENABLED=true
FEATURE_FITNESS_TRACKING_ENABLED=true
FEATURE_SOCIAL_FEATURES_ENABLED=false
FEATURE_BETA_FEATURES_ENABLED=false

# ===================================
# n8n WORKFLOW AUTOMATION
# ===================================
N8N_WEBHOOK_URL=${N8N_WEBHOOK_URL}
N8N_API_KEY=${N8N_API_KEY}
N8N_WEBHOOK_SECRET=${N8N_WEBHOOK_SECRET}
N8N_ENABLED=true

# ===================================
# PERFORMANCE & SCALING
# ===================================
# HTTP Client Settings
HTTP_TIMEOUT=30000
HTTP_MAX_REDIRECTS=5
HTTP_KEEP_ALIVE=true

# Request Processing
MAX_REQUEST_SIZE=50MB
BODY_PARSER_LIMIT=10MB
URL_LIMIT=1000

# Background Jobs
QUEUE_REDIS_URL=${REDIS_URL}
QUEUE_CONCURRENCY=10
QUEUE_MAX_RETRIES=3
QUEUE_RETRY_DELAY=5000

# ===================================
# HEALTH CHECKS & MAINTENANCE
# ===================================
HEALTH_CHECK_TIMEOUT=5000
READINESS_CHECK_TIMEOUT=10000
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE="System maintenance in progress"

# Database Maintenance
DB_BACKUP_ENABLED=true
DB_BACKUP_SCHEDULE="0 2 * * *"
DB_CLEANUP_ENABLED=true
DB_CLEANUP_RETENTION_DAYS=365

# ===================================
# COMPLIANCE & PRIVACY
# ===================================
# Data Retention
DATA_RETENTION_ENABLED=true
USER_DATA_RETENTION_DAYS=2555  # 7 years
CHAT_DATA_RETENTION_DAYS=365   # 1 year
LOG_DATA_RETENTION_DAYS=90     # 3 months

# Privacy Settings
GDPR_COMPLIANCE=true
HIPAA_COMPLIANCE=true
DATA_ANONYMIZATION=true
AUDIT_LOGGING=true

# Geographic Restrictions
BLOCKED_COUNTRIES=
RESTRICTED_FEATURES_BY_REGION=
DATA_RESIDENCY_REQUIREMENTS=US,EU